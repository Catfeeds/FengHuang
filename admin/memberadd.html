<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>新增用户</title>
<link href="assets/css/admin.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="assets/js/jquery.js"></script>
<script type="text/javascript" src="assets/js/forms.js"></script>
<script type="text/javascript" src="assets/js/json2.js"></script>
<script type="text/javascript" src="assets/js/knockout-3.2.0.js"></script>
<script type="text/javascript" src="assets/js/mapping_debug.js"></script>
<script type="text/javascript" src="global_url.js"></script>
<script type="text/javascript" src="global_var.js"></script>
<script type="text/javascript" src="common.js"></script>
<script type="text/javascript" src="assets/js/ajax.js"></script>

<script type="text/javascript">
var viewModel;
var sexDic;
var bloodTypeDic;
var constellationDic;
function onload(){
	//获取各种字典
	$.getJSON(CATEGORY_QUERY+'sex',null,afterGetSexDic);
}
function afterGetSexDic(data){
	sexDic = data.result;
	$.getJSON(CATEGORY_QUERY+'constellation',afterGetConstellationDic);
	
}
function afterGetConstellationDic(data){
	constellationDic = data.result;
	$.getJSON(CATEGORY_QUERY+'blood',afterGetBloodTypeDic);
		
}
function afterGetBloodTypeDic(data){	
	bloodTypeDic = data.result;
	var data = {
					"id":null,
					"username":null,
					"verified":false,
					"cnname":null,
					"realName":null,
					"ename":null,
					"sex":null,
					"sexId":null,
					"mobile":null,
					"intro":null,
					"email":null,
					"qqnum":null,
					"qqid":null,
					"weixinnum":null,
					"weixinid":null,
					"birthDay":'2015-06-11',
					'bloodType':null,
					"bloodTypeId":null,
					"constellation":null,
					"constellationId":null,
					"avatar":null,
					"trade":null,
					"address":null,
					"expVal":0,
					"integra":0,
					"regTime":null,
					"regIp":null,
					"loginTime":null,
					"loginip":null,
					"weiboid":null,
					"infoComplete":false
				};
	viewModel = ko.mapping.fromJS(data);

	viewModel.submit = function(){
			//经测试除password外其他均可为null
			var birthDay = document.getElementById("birthDay").value;
			viewModel.birthDay(birthDay);
	 		var modelObj = ko.mapping.toJS(viewModel);	 
	 		if(viewModel.sex()){
	 			modelObj.sexId = viewModel.sex().id;
	 		}
	 	
	 		if(viewModel.bloodType()){
	 			modelObj.bloodTypeId = viewModel.bloodType().id;
	 		}
	 	
	 		if(viewModel.constellation()){
	 			modelObj.constellationId = viewModel.constellation().id;
	 		}
	 		modelObj.password = '1';
	 		//modelObj.regIp = '';	 		
	 		//modelObj.regTime= '';
	 		//modelObj.loginTime= '';
	 		//modelObj.loginip = '';
	 		//modelObj.avatarid='404040e64d8fa9d4014d8fa9e2150000';
	 		var url = "http://101.200.229.135:8080/api/admin/user/?";
	 		$.post(url,modelObj,function(data){	 			
	 			var dataObj = JSON.parse(data);
	 			friendlyTip(dataObj);
	 		});
	 	};
	 viewModel.sexDic = ko.observableArray(sexDic);
	ko.applyBindings(viewModel);
}
</script>
</head>
<body onload="onload()">
<div class="formHeader">
 <span class="title">新增用户</span> <a href="javascript:location.reload();" class="reload">刷新</a> 
</div>
<form name="form" id="form" method="post">
	<table class="formTable" border="0" cellpadding="0" cellspacing="0" width="100%">
		<tbody>
		
			<tr>
				<td align="right"  height="40">用户名:</td>
				<td   ><input type="text" data-bind="value:username"></td>
		
				<td align="right"  height="40">姓名:</td>
				<td  ><input type="text" data-bind='value:realName'></td>
			</tr>
			<tr>
				<td align="right"  height="40">中文名:</td>
				<td  ><input type="text" data-bind='value:cnname'></td>
		
				<td align="right"  height="40">英文名:</td>
				<td  ><input type="text" data-bind='value:ename'></td>
			</tr>
			<tr>
				<td align="right"  height="40">验证状态: </td>
				<td  >&nbsp;&nbsp;<input type="checkbox" data-bind="checked: verified" />&nbsp;通过					
    				<!--input type="text" data-bind="value:verified?'已通过验证':'未通过验证'"> 放弃radio是因为不支持bool型</td-->		
				<td align="right"  height="40">性别:</td>
				<td><select data-bind="value:sex,options:sexDic,optionsText:'name',valueAllowUnset: true,optionsCaption: '请选择...'">
				</select>
				<input type='text' size=50 data-bind="value:sex()?sex().id:'unknow'">
				</td>
			</tr>
			<tr>
				<td align="right" height="40">电话：</td>
				<td ><input type="text" data-bind="value:mobile"></td>		
				<td align="right" height="40">邮箱：</td>
				<td ><input type="text" data-bind="value:email"></td>
			</tr>
			<tr>
				<td align="right" height="40">QQ：</td>
				<td ><input type="text" data-bind="value:qqnum"></td>
				<td align="right" height="40">QQID：</td>
				<td ><input type="text" data-bind="value:qqid"></td>
			</tr>
			<tr>
					
				<td align="right" height="40">微信号：</td>
				<td ><input type="text" data-bind="value:weixinnum"></td>
				<td align="right" height="40">微信ID：</td>
				<td ><input type="text" data-bind="value:weixinid"></td>
			</tr>
			<tr>
				<td align="right" height="40">微博：</td>
				<td ><input type="text" data-bind="value:weiboid"></td>	
				<td align="right" height="40">血型：</td>
				<td >
				<select data-bind="value:bloodType,options:bloodTypeDic,optionsText:'name',valueAllowUnset: true,optionsCaption: '请选择...'">
				</select>
				<input type="text" data-bind="value:bloodType()?bloodType().id:''"></td>
			</tr>
			<tr>
				<td align="right" height="40">头像：</td>
				<td ><input type="text" data-bind="value:avatar"></td>		
				<td align="right" height="40">职业：</td>
				<td ><input type="text" data-bind="value:trade"></td>
			</tr>		
			<tr>
				<td align="right" height="40">经验值：</td>
				<td ><input type="text" data-bind="value:expVal"></td>		
				<td align="right" height="40">积分：</td>
				<td ><input type="text" data-bind="value:integra"></td>
			</tr>
			
			<tr>
				<td align="right" height="40">生日：</td>
				<td><input type="text" id="birthDay" class="inputms" data-bind="value:birthDay" readonly="readonly" />
					<script type="text/javascript" src="assets/plugin/calendar/calendar.js"></script> 
					<script type="text/javascript">
					Calendar.setup({
						inputField     :    "birthDay",
						//ifFormat       :    "%Y-%m-%d",
						ifFormat       :    "%Y-%m-%d",
						showsTime      :    false,
						timeFormat     :    "24"
					});
					</script>
				</td>
				<!--td data-bind="text:constellation"></td-->		
				<td align="right" height="40" >星座：</td>
				<td>
				<select data-bind="value:constellation,options:constellationDic,optionsText:'name',valueAllowUnset: true,optionsCaption: '请选择...'">
				</select>
				<input type="text" size=100 data-bind="value:constellation()?constellation().id:'unknow'">
				</td>		
				
			</tr>
				<tr>
				<td align="right" height="40">个人信息：</td>
				<td colspan=3><input type="text" size=100 data-bind="value:intro"></td>
			</tr>
			<tr>
				<td align="right" height="40">地址：					
				</td>
				<td colspan=3>
					<input type="text" size=100 data-bind="value:address"/>
				</td>
			</tr>		
		</tbody>
	</table>
	<div class="formSubBtn">
		<input class="submit" value="提交" type="button" data-bind="click:submit"/>
		<input class="back" value="返回" onclick="history.go(-1)" type="button">
		<input name="id" id="id"   type="hidden">
	</div>
</form>

</body></html>